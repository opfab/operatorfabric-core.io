<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Development environment</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="dev_env" class="article toc2 toc-left">
<div id="header">
<h1>Development environment</h1>
<div class="details">
<span id="revnumber">version 3.8.0.RELEASE,</span>
<span id="revdate">20 June 2022</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_requirements">1. Requirements</a>
<ul class="sectlevel2">
<li><a href="#_tools_and_libraries">1.1. Tools and libraries</a></li>
<li><a href="#_software">1.2. Software</a></li>
<li><a href="#_browser_support">1.3. Browser support</a></li>
</ul>
</li>
<li><a href="#setup_dev_env">2. Setting up your development environment</a>
<ul class="sectlevel2">
<li><a href="#_clone_repository">2.1. Clone repository</a></li>
<li><a href="#_set_up_your_environment_environment_variables_appropriate_versions_of_tools">2.2. Set up your environment (environment variables &amp; appropriate versions of tools)</a></li>
<li><a href="#_deploy_needed_docker_containers">2.3. Deploy needed docker containers</a>
<ul class="sectlevel3">
<li><a href="#_a_minimal_configuration_for_gradle_build">2.3.1. A Minimal Configuration for <code>gradle</code> Build</a></li>
<li><a href="#_enabling_local_quality_report_generation">2.3.2. Enabling local quality report generation</a></li>
<li><a href="#_docker_dev_env">2.3.3. Development environment</a></li>
</ul>
</li>
<li><a href="#_build_operatorfabric_with_gradle">2.4. Build OperatorFabric with Gradle</a></li>
<li><a href="#_run_operatorfabric_services_using_the_run_all_sh_script">2.5. Run OperatorFabric Services using the <code>run_all.sh</code> script</a></li>
<li><a href="#_check_services_status">2.6. Check services status</a></li>
<li><a href="#_log_into_the_ui">2.7. Log into the UI</a></li>
<li><a href="#_push_cards_to_the_feed">2.8. Push cards to the feed</a></li>
</ul>
</li>
<li><a href="#_user_interface">3. User Interface</a>
<ul class="sectlevel2">
<li><a href="#_build">3.1. Build</a></li>
<li><a href="#_test">3.2. Test</a>
<ul class="sectlevel3">
<li><a href="#_standalone_tests">3.2.1. Standalone tests</a></li>
<li><a href="#_test_during_ui_development">3.2.2. Test during UI development</a>
<ul class="sectlevel4">
<li><a href="#_troubleshooting">3.2.2.1. Troubleshooting :</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_environment_variables">4. Environment variables</a></li>
<li><a href="#_project_structure">5. Project Structure</a>
<ul class="sectlevel2">
<li><a href="#_conventions_regarding_project_structure_and_configuration">5.1. Conventions regarding project structure and configuration</a>
<ul class="sectlevel3">
<li><a href="#_java">5.1.1. Java</a></li>
<li><a href="#_modeling">5.1.2. Modeling</a></li>
<li><a href="#_docker">5.1.3. Docker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_development_tools">6. Development tools</a>
<ul class="sectlevel2">
<li><a href="#_scripts_bin_and_cicd">6.1. Scripts (bin and CICD)</a>
<ul class="sectlevel3">
<li><a href="#_run_all_sh">6.1.1. run_all.sh</a></li>
</ul>
</li>
<li><a href="#gradle_tasks">6.2. Gradle Tasks</a>
<ul class="sectlevel3">
<li><a href="#_services">6.2.1. Services</a>
<ul class="sectlevel4">
<li><a href="#_common_tasks_for_all_sub_projects">6.2.1.1. Common tasks for all sub-projects</a></li>
<li><a href="#_businessconfig_service">6.2.1.2. Businessconfig Service</a></li>
<li><a href="#_toolsgeneric">6.2.1.3. tools/generic</a></li>
</ul>
</li>
<li><a href="#_client_library">6.2.2. Client Library</a>
<ul class="sectlevel4">
<li><a href="#client_lib_pub_conf">6.2.2.1. Configuration</a></li>
<li><a href="#_relevant_tasks">6.2.2.2. Relevant tasks</a></li>
</ul>
</li>
<li><a href="#_gradle_plugins">6.2.3. Gradle Plugins</a></li>
</ul>
</li>
<li><a href="#_api_testing_with_karate_dsl">6.3. API testing with Karate DSL</a>
<ul class="sectlevel3">
<li><a href="#_run_a_feature">6.3.1. Run a feature</a></li>
<li><a href="#_non_regression_tests">6.3.2. Non regression tests</a></li>
</ul>
</li>
<li><a href="#_cypress_tests">6.4. Cypress Tests</a>
<ul class="sectlevel3">
<li><a href="#_installation">6.4.1. Installation</a></li>
<li><a href="#_cypress_file_structure">6.4.2. Cypress file structure</a></li>
<li><a href="#_launching_the_opfab_instance_to_test">6.4.3. Launching the OpFab instance to test</a>
<ul class="sectlevel4">
<li><a href="#_commands">6.4.3.1. Commands</a></li>
<li><a href="#_explanation">6.4.3.2. Explanation</a></li>
</ul>
</li>
<li><a href="#_running_existing_tests">6.4.4. Running existing tests</a></li>
<li><a href="#_running_tests_on_4200_ng_serve">6.4.5. Running tests on 4200 (ng serve)</a></li>
<li><a href="#_running_tests_with_gradle">6.4.6. Running tests with Gradle</a></li>
<li><a href="#_clearing_mongodb">6.4.7. Clearing MongoDB</a></li>
<li><a href="#_current_status_of_tests">6.4.8. Current status of tests</a></li>
<li><a href="#_creating_new_tests">6.4.9. Creating new tests</a>
<ul class="sectlevel4">
<li><a href="#_useful_documentation">6.4.9.1. Useful documentation</a></li>
<li><a href="#_guidelines_and_tips">6.4.9.2. Guidelines and tips</a></li>
</ul>
</li>
<li><a href="#_configuration">6.4.10. Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_useful_recipes">7. Useful recipes</a>
<ul class="sectlevel2">
<li><a href="#_running_sub_project_from_jar_file">7.1. Running sub-project from jar file</a></li>
<li><a href="#_overriding_properties_when_running_from_jar_file">7.2. Overriding properties when running from jar file</a></li>
<li><a href="#_generating_docker_images">7.3. Generating docker images</a></li>
<li><a href="#_generating_documentation_from_asciidoc_sources">7.4. Generating documentation (from AsciiDoc sources)</a></li>
<li><a href="#_generating_api_documentation">7.5. Generating API documentation</a></li>
</ul>
</li>
<li><a href="#troubleshooting">8. Troubleshooting</a></li>
<li><a href="#_keycloak_configuration">9. Keycloak Configuration</a>
<ul class="sectlevel2">
<li><a href="#_add_realm">9.1. Add Realm</a></li>
<li><a href="#_setup_at_least_one_client_or_best_one_per_service">9.2. Setup at least one client (or best one per service)</a>
<ul class="sectlevel3">
<li><a href="#_create_client">9.2.1. Create client</a></li>
<li><a href="#_add_a_role_to_client">9.2.2. Add a Role to Client</a></li>
</ul>
</li>
<li><a href="#_create_users">9.3. Create Users</a>
<ul class="sectlevel3">
<li><a href="#_development_specific_configuration">9.3.1. Development-specific configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_using_oauth2_token_with_the_cli">10. Using OAuth2 token with the CLI</a>
<ul class="sectlevel2">
<li><a href="#_get_a_token">10.1. Get a token</a>
<ul class="sectlevel3">
<li><a href="#_curl">10.1.1. Curl</a></li>
<li><a href="#_httpie">10.1.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_extract_token">10.2. Extract token</a>
<ul class="sectlevel3">
<li><a href="#_curl_2">10.2.1. Curl</a></li>
<li><a href="#_httpie_2">10.2.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_check_a_token">10.3. Check a token</a>
<ul class="sectlevel3">
<li><a href="#_curl_3">10.3.1. Curl</a></li>
<li><a href="#_httpie_3">10.3.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_extract_token_2">10.4. Extract token</a></li>
</ul>
</li>
<li><a href="#_kafka_implementation">11. Kafka Implementation</a>
<ul class="sectlevel2">
<li><a href="#_setup_kafka_enviroment">11.1. Setup Kafka enviroment</a></li>
<li><a href="#_enabling_kafka">11.2. Enabling Kafka</a></li>
<li><a href="#_operatorfabric_kafka_source_code">11.3. OperatorFabric Kafka source code</a></li>
<li><a href="#_listener_deserializer">11.4. Listener / deserializer</a>
<ul class="sectlevel3">
<li><a href="#_kafka_operatorfabric_avro_schema">11.4.1. Kafka OperatorFabric AVRO schema</a></li>
</ul>
</li>
<li><a href="#_configure_kafka">11.5. Configure Kafka</a>
<ul class="sectlevel3">
<li><a href="#_setting_a_new_deserializer">11.5.1. Setting a new deserializer</a></li>
<li><a href="#_configuring_a_broker">11.5.2. Configuring a broker</a></li>
</ul>
</li>
<li><a href="#_kafka_card_producer">11.6. Kafka card producer</a></li>
<li><a href="#_response_cards">11.7. Response Cards</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to provide all the necessary information to developers who would like to start working on
OperatorFabric.
It will walk you through setting up the necessary tooling to be able to launch OperatorFabric in development mode,
describe the structure of the project and point out useful tools (Gradle tasks, scripts, etc.) for development purposes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements"><a class="anchor" href="#_requirements"></a>1. Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the projects requirements regardless of installation options.
Please see
<a href="/documentation/current/dev_env/index.html#setup_dev_env">Setting up your environment</a>
below for details on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>setting up a development environment with these prerequisites</p>
</li>
<li>
<p>building and running OperatorFabric</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_tools_and_libraries"><a class="anchor" href="#_tools_and_libraries"></a>1.1. Tools and libraries</h3>
<div class="ulist">
<ul>
<li>
<p>Java 11.0<br></p>
</li>
<li>
<p>Docker</p>
</li>
<li>
<p>Docker Compose with 2.1+ file format support</p>
</li>
<li>
<p>Chrome (needed for UI tests in build)</p>
</li>
<li>
<p>Node 14.15 (Npm 6.14)</p>
</li>
<li>
<p><a href="https://stedolan.github.io/jq/">jq</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the current Jdk used for the project is Java 11.0.14-zulu.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is highly recommended to use <a href="https://sdkman.io/">sdkman</a> and
<a href="https://github.com/nvm-sh/nvm">nvm</a> to manage tools versions. The following steps rely on these tools.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have installed sdkman and nvm, you can <strong>source</strong> the following
script to set up your development environment (appropriate versions of Node
Java and project variables set):</p>
</div>
<div class="listingblock">
<div class="title">Set up development environment (using sdkman and nvm)</div>
<div class="content">
<pre class="CodeRay highlight"><code>source bin/load_environment_light.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_software"><a class="anchor" href="#_software"></a>1.2. Software</h3>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ 3.7.6 +: AMQP messaging layer allows inter
service communication</p>
</li>
<li>
<p>MongoDB 4.4 +: Card persistent storage</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RabbitMQ is required for :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Card AMQP push</p>
</li>
<li>
<p>Multiple service sync</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MongoDB is required for :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Current Card storage</p>
</li>
<li>
<p>Archived Card storage</p>
</li>
<li>
<p>User Storage</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Installing MongoDB and RabbitMQ is not necessary as preconfigured
MongoDB and RabbitMQ are available in the form of docker-compose configuration
files at
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker">src/main/docker</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_browser_support"><a class="anchor" href="#_browser_support"></a>1.3. Browser support</h3>
<div class="paragraph">
<p>The project is tested on recent versions of Firefox, Chromium and Chrome.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup_dev_env"><a class="anchor" href="#setup_dev_env"></a>2. Setting up your development environment</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The steps below assume that you have installed and are using
<a href="https://sdkman.io/">sdkman</a> and
<a href="https://github.com/nvm-sh/nvm">nvm</a> to manage tool versions ( for java,
 node and npm).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several ways to get started with <code>OperatorFabric</code>. Please look into
the section that best fits your needs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you encounter any issue, see
<a href="/documentation/current/dev_env/index.html#troubleshooting">Troubleshooting</a>
below. In particular,
a command that hangs then fails is often a proxy issue.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following steps describe how to launch MongoDB, RabbitMQ and Keycloak
using Docker,  build OperatorFabric using gradle and run it using the
<code>run_all.sh</code> script.</p>
</div>
<div class="sect2">
<h3 id="_clone_repository"><a class="anchor" href="#_clone_repository"></a>2.1. Clone repository</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">git clone https://github.com/opfab/operatorfabric-core.git
cd operatorfabric-core</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_your_environment_environment_variables_appropriate_versions_of_tools"><a class="anchor" href="#_set_up_your_environment_environment_variables_appropriate_versions_of_tools"></a>2.2. Set up your environment (environment variables &amp; appropriate versions of tools)</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">source bin/load_environment_light.sh</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
From now on, you can use environment variable <code>${OF_HOME}</code> to go back to
the home repository of <code>OperatorFabric</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_needed_docker_containers"><a class="anchor" href="#_deploy_needed_docker_containers"></a>2.3. Deploy needed docker containers</h3>
<div class="sect3">
<h4 id="_a_minimal_configuration_for_gradle_build"><a class="anchor" href="#_a_minimal_configuration_for_gradle_build"></a>2.3.1. A Minimal Configuration for <code>gradle</code> Build</h4>
<div class="paragraph">
<p>The gradle build of <code>OperatorFabric</code> requires (for the unit tests) two docker containers running:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ;</p>
</li>
<li>
<p>MongoDB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Launch them using the <code>${OF_HOME}/src/main/docker/test-environment/docker-compose.yml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_local_quality_report_generation"><a class="anchor" href="#_enabling_local_quality_report_generation"></a>2.3.2. Enabling local quality report generation</h4>
<div class="paragraph">
<p>Sonarqube reporting, in addition to the two previously listed docker containers, needs a <code>SonarQube</code> docker container.
Use the <code>${OF_HOME}/src/main/docker/test-quality-environment/docker-compose.yml</code> to get them all running.</p>
</div>
<div class="paragraph">
<p>To generate the quality report, run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew jacocoTestReport</code></pre>
</div>
</div>
<div class="paragraph">
<p>To export the reports into the <code>SonarQube</code> docker instance, install and use <a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/">SonarScanner</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker_dev_env"><a class="anchor" href="#_docker_dev_env"></a>2.3.3. Development environment</h4>
<div class="paragraph">
<p><code>OperatorFabric</code> development needs docker images of <code>MongoDB</code>, <code>RabbitMQ</code>, <code>web-ui</code> and <code>Keycloak</code> running.
The <code>web-ui</code> configuration needs a <code>nginx.conf</code>.</p>
</div>
<div class="paragraph">
<p>The <code>${OF_HOME}/config/dev/docker-compose.sh</code> creates the <code>nginx.conf</code> file and then runs <code>docker-compose</code> in detached mode.
For this, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <code>nginx.conf</code> created, run <code>docker-compose</code> independently is possible using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}/config/dev
docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the <code>web-ui</code> embeds a grayscale favicon which can be useful to spot the <code>OperatorFabric</code> dev tab in the browser.
To refresh the favicon, hit <code>CTRL+F5</code> on the page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_operatorfabric_with_gradle"><a class="anchor" href="#_build_operatorfabric_with_gradle"></a>2.4. Build OperatorFabric with Gradle</h3>
<div class="paragraph">
<p>Using the wrapper in order to ensure building the project the same way from one machine to another.</p>
</div>
<div class="paragraph">
<p>To only compile and package the jars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew assemble</code></pre>
</div>
</div>
<div class="paragraph">
<p>To launch the Unit Test, compile and package the jars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
docker-compose -f ${OF_HOME}/src/main/docker/test-environment/docker-compose.yml up -d
./gradlew build</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_operatorfabric_services_using_the_run_all_sh_script"><a class="anchor" href="#_run_operatorfabric_services_using_the_run_all_sh_script"></a>2.5. Run OperatorFabric Services using the <code>run_all.sh</code> script</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
docker-compose -f ${OF_HOME}/config/dev/docker-compose.yml up -d
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See <code>bin/run_all.sh -h</code> for details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_check_services_status"><a class="anchor" href="#_check_services_status"></a>2.6. Check services status</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
bin/run_all.sh status</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log_into_the_ui"><a class="anchor" href="#_log_into_the_ui"></a>2.7. Log into the UI</h3>
<div class="paragraph">
<p><strong><em>URL:</em></strong> localhost:2002/<br>
<strong><em>login:</em></strong> operator1_fr<br>
<strong><em>password:</em></strong> test</p>
</div>
<div class="paragraph">
<p>The other users available in development mode are <code>operator3_fr</code> and <code>admin</code>, both with <code>test</code> as password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It might take a little while for the UI to load even after all services are running.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Don&#8217;t forget the <strong>final slash</strong> in the URL or you will get an error, a <code>404</code> page.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_push_cards_to_the_feed"><a class="anchor" href="#_push_cards_to_the_feed"></a>2.8. Push cards to the feed</h3>
<div class="paragraph">
<p>You can check that you see cards into the feed by running the following scripts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">./src/test/resources/loadTestConf.sh
./src/test/resources/send6TestCards.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_interface"><a class="anchor" href="#_user_interface"></a>3. User Interface</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the following document the variable declared as <code>OF_HOME</code> is the root folder of the <code>operatorfabric-core project</code>.
</td>
</tr>
</table>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CLI
</td>
<td class="hdlist2">
<p>stands for <strong>Command Line Interface</strong></p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_build"><a class="anchor" href="#_build"></a>3.1. Build</h3>
<div class="paragraph">
<p>Within the folder <code>${OF_HOME}/ui/main</code>, run <code>ng build</code> to build the project.</p>
</div>
<div class="paragraph">
<p>The build artifacts will be stored in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">${OF_HOME}/ui/main/build/distribution</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command could lead to the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Generating ES5 bundles for differential loading...
An unhandled exception occurred: Call retries were exceeded
See &quot;/tmp/ng-&lt;random-string&gt;/angular-errors.log&quot; for further details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ng-&lt;random-string&gt;</code> is a temporary folder created by Angular to build the front-end.</p>
</div>
<div class="paragraph">
<p>Use <code>node --max_old_space_size=4096 node_modules/@angular/cli/bin/ng build</code> instead to solve this problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test"><a class="anchor" href="#_test"></a>3.2. Test</h3>
<div class="sect3">
<h4 id="_standalone_tests"><a class="anchor" href="#_standalone_tests"></a>3.2.1. Standalone tests</h4>
<div class="paragraph">
<p>Run in the <code>${OF_HOME}/ui/main</code> directory the command <code>ng test --watch=false</code> to execute the unit tests
on <a href="https://jasmine.github.io">Jasmine</a> using <a href="https://karma-runner.github.io">Karma</a> to drive the browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_during_ui_development"><a class="anchor" href="#_test_during_ui_development"></a>3.2.2. Test during UI development</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if the RabbitMQ, MongoDB and Keycloak docker containers are not running, launch them;</p>
</li>
<li>
<p>set your environment variables with <code>source ${OF_HOME}/bin/load_environment_light.sh</code>;</p>
</li>
<li>
<p>run the micro services using the same command as earlier: <code>${OF_HOME}/bin/run_all.sh start</code>;</p>
</li>
<li>
<p>launch an angular server with the command: <code>ng serve</code>;</p>
</li>
<li>
<p>test your changes in your browser using this url: <code><a href="http://localhost:4200" class="bare">localhost:4200</a></code> which leads to <code><a href="http://localhost:4200/#/feed" class="bare">localhost:4200/#/feed</a></code>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>3.2.2.1. Troubleshooting :</h5>
<div class="paragraph">
<p>If <code>ng serve</code> returns the error <code>Command 'ng' not found</code>, install the Angular CLI globally with the following
command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>npm install -g @angular/cli</pre>
</div>
</div>
<div class="paragraph">
<p>This will install the latest version of the Angular command line, which might not be in line with the one used by the
project, but it&#8217;s not an issue as when you run <code>ng serve</code> the local version of the Angular CLI
(as defined in the package.json file) will be used.</p>
</div>
<div class="paragraph">
<p>If it is still not running , launch in the ui/main directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre>npm link @angular/cli</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>4. Environment variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These variables are loaded by bin/load_environment_light.sh</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OF_HOME: OperatorFabric root dir</p>
</li>
<li>
<p>OF_VERSION : OperatorFabric version, as defined in the <code>$OF_HOME/VERSION</code> file</p>
</li>
<li>
<p>OF_CLIENT_REL_COMPONENTS : List of modules for the client libraries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, you may want to configure the following variables</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker build proxy configuration (used to configure alpine apk proxy
settings)</p>
<div class="ulist">
<ul>
<li>
<p>APK_PROXY_URI</p>
</li>
<li>
<p>APK_PROXY_HTTPS_URI</p>
</li>
<li>
<p>APK_PROXY_USER</p>
</li>
<li>
<p>APK_PROXY_PASSWORD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_structure"><a class="anchor" href="#_project_structure"></a>5. Project Structure</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/bin">bin</a>: contains useful scripts for dev purposes</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/CICD/github">github</a>: scripts used by Github for the
build process</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client">client</a>: contains REST APIs simple beans definition, may be
used by external projects</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client/cards">cards (cards-client-data)</a>: simple beans regarding cards</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client/src">src</a>: contains swagger templates for <a href="https://github.com/opfab/operatorfabric-core/tree/master/client">client</a>
code generation</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client/users">users (users-client-data)</a>: simple beans regarding users</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/config">config</a>: contains external configurations for all services , keycloak and docker-compose files to help with tests and demonstrations</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services">services</a>: contains the microservices that make up
OperatorFabric</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/cards-consultation">cards-consultation
(cards-consultation-service)</a>: Card consultation service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/cards-publication">cards-publication
(cards-publication-service)</a>: Card publication service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/external-devices">external-devices
(external-devices-service)</a>: External Devices service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/src">src</a>: contains swagger templates for services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/businessconfig">businessconfig (businessconfig-service)</a>:
Businessconfig-party information management service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/users">users (users-service)</a>: Users management
service</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/web-ui">web-ui</a>: project based on Nginx server to serve
the OperatorFabric UI</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src">src</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs">docs</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs/asciidoc">asciidoc</a>: General documentation (Architecture,
Getting Started Guide, etc.)</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main">main</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker">docker</a>: contains docker-compose files to help with
tests and demonstrations</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test">test</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/api">api</a> : karate code for automatic api testing (non-regression tests)</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/cypress">cypress</a> : cypress code for automatic ui testing</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/dummyModbusDevice">dummyModbusDevice</a> : application emulating a Modbus device for test purposes</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources">resources</a> : scripts and data for manual testing</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools">tools</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/generic">generic</a>: Generic (as opposed to Spring-related)
utility code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/generic/test-utilities">test-utilities</a>: Test-specific
utility code</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/generic/utilities">utilities</a>: Utility code</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring">spring</a>: Spring-related utility code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-mongo-utilities">spring-mongo-utilities</a> : Utility
code with Spring-specific dependencies, used to share common features across
MongoDB-dependent services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-oauth2-utilities">spring-oauth2-utilities</a> :
Utility code with Spring-specific dependencies, used to share common features
across OAuth2-dependent services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-test-utilities">spring-test-utilities</a> : Utility
code with Spring-specific dependencies for testing purposes</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-utilities">spring-utilities</a> : Utility code with
Spring-specific dependencies</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/swagger-spring-generators">swagger-spring-generators</a> : Spring
Boot generator for swagger, tailored for OperatorFabric needs</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/ui">ui</a>: Angular sources for the UI</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_conventions_regarding_project_structure_and_configuration"><a class="anchor" href="#_conventions_regarding_project_structure_and_configuration"></a>5.1. Conventions regarding project structure and configuration</h3>
<div class="paragraph">
<p>Sub-projects must conform to a few rules in order for the configured Gradle
tasks to work:</p>
</div>
<div class="sect3">
<h4 id="_java"><a class="anchor" href="#_java"></a>5.1.1. Java</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
[sub-project]/src/main/java
</td>
<td class="hdlist2">
<p>contains java source code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/test/java
</td>
<td class="hdlist2">
<p>contains java tests source code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/main/resources
</td>
<td class="hdlist2">
<p>contains resource files</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/test/resources
</td>
<td class="hdlist2">
<p>contains test resource files</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modeling"><a class="anchor" href="#_modeling"></a>5.1.2. Modeling</h4>
<div class="paragraph">
<p>Core services projects declaring REST APIS that use Swagger for their
definition must declare two files:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
[sub-project]/src/main/modeling/swagger.yaml
</td>
<td class="hdlist2">
<p>Swagger API definition</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/main/modeling/config.json
</td>
<td class="hdlist2">
<p>Swagger generator configuration</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_docker"><a class="anchor" href="#_docker"></a>5.1.3. Docker</h4>
<div class="paragraph">
<p>Services project all have docker image generated in their build cycle. See
<a href="/documentation/current/dev_env/index.html#gradle_tasks">Gradle Tasks</a>
for details.</p>
</div>
<div class="paragraph">
<p>Per project configuration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>docker file : <strong>[sub-project]/src/main/docker/Dockerfile</strong></p>
</li>
<li>
<p>docker-compose file : <strong>[sub-project]/src/main/docker/docker-compose.yml</strong></p>
</li>
<li>
<p>runtime data : <strong>[sub-project]/src/main/docker/volume</strong> is copied to
<strong>[sub-project]/build/docker-volume/</strong> by task <strong>copyWorkingDir</strong>. The latest
can then be mounted as volume in docker containers.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_tools"><a class="anchor" href="#_development_tools"></a>6. Development tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scripts_bin_and_cicd"><a class="anchor" href="#_scripts_bin_and_cicd"></a>6.1. Scripts (bin and CICD)</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
bin/load_environment_light.sh
</td>
<td class="hdlist2">
<p>sets up environment when <strong>sourced</strong> (java
version &amp; node version)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
bin/run_all.sh
</td>
<td class="hdlist2">
<p>runs all all services (see below)</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_run_all_sh"><a class="anchor" href="#_run_all_sh"></a>6.1.1. run_all.sh</h4>
<div class="paragraph">
<p>Please see <code>run_all.sh -h</code> usage before running.</p>
</div>
<div class="paragraph">
<p>Prerequisites</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mongo running on port 27017 with user "root" and password "password"
(See src/main/docker/mongodb/docker-compose.yml for a pre configured instance).</p>
</li>
<li>
<p>rabbitmq running on port 5672 with user "guest" and password "guest"
(See src/main/docker/rabbitmq/docker-compose.yml for a pre configured
instance).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Ports configuration</strong>
 </summary><div> </p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web ui and gateway  (Nginx server)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Businessconfig service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card publication service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_tasks"><a class="anchor" href="#gradle_tasks"></a>6.2. Gradle Tasks</h3>
<div class="paragraph">
<p>In this section only custom tasks are described. For more
information on tasks, refer to the output of the "tasks" gradle task and
to gradle and plugins official documentation.</p>
</div>
<div class="sect3">
<h4 id="_services"><a class="anchor" href="#_services"></a>6.2.1. Services</h4>
<div class="sect4">
<h5 id="_common_tasks_for_all_sub_projects"><a class="anchor" href="#_common_tasks_for_all_sub_projects"></a>6.2.1.1. Common tasks for all sub-projects</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
</li>
<li>
<p>Other:</p>
<div class="ulist">
<ul>
<li>
<p>copyWorkingDir: copies [sub-project]/src/main/docker/volume to
[sub-project]/build/</p>
</li>
<li>
<p>copyDependencies: copy dependencies to build/support_libs (for Sonar)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_businessconfig_service"><a class="anchor" href="#_businessconfig_service"></a>6.2.1.2. Businessconfig Service</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>prepareTestDataDir: prepare directory (build/test-data) for test data</p>
</li>
<li>
<p>compressBundle1Data, compressBundle2Data: generate tar.gz businessconfig party
configuration data for tests in build/test-data</p>
</li>
<li>
<p>prepareDevDataDir: prepare directory (build/dev-data) for bootRun task</p>
</li>
<li>
<p>createDevData: prepare data in build/test-data for running bootRun task
during development</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other tasks</p>
<div class="ulist">
<ul>
<li>
<p>copyCompileClasspathDependencies: copy compile classpath dependencies,
catching lombok that must be sent for sonarqube</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_toolsgeneric"><a class="anchor" href="#_toolsgeneric"></a>6.2.1.3. tools/generic</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>prepareTestData: copy test data from src/test/data/simple to
build/test-data/</p>
</li>
<li>
<p>compressTestArchive: compress the contents of /src/test/data/archive to
/build/test-data/archive.tar.gz</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_library"><a class="anchor" href="#_client_library"></a>6.2.2. Client Library</h4>
<div class="paragraph">
<p>The jars produced by the projects under "client" will now be published to Maven Central after each release to make
integration in client applications more manageable (see <a href="https://central.sonatype.org/publish">the official Sonatype
documentation</a>) for more information about the requirements and publishing process.</p>
</div>
<div class="paragraph">
<p>To that end, we are using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.gradle.org/current/userguide/publishing_maven.html">Maven Publish</a> Gradle plugin to take care of the
metadata (producing the required pom.xml for example) and publishing the artifacts to a staging repository</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/current/userguide/signing_plugin.html">Signing</a> Gradle plugin to sign the produced artifacts
using a GPG key.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="client_lib_pub_conf"><a class="anchor" href="#client_lib_pub_conf"></a>6.2.2.1. Configuration</h5>
<div class="paragraph">
<p>For the signing task to work, you need to :</p>
</div>
<div class="sect5">
<h6 id="_import_the_opfab_secret_key_file"><a class="anchor" href="#_import_the_opfab_secret_key_file"></a>Import the opfab secret key file</h6>
<div class="listingblock">
<div class="content">
<pre>gpg2 --import OPFAB_KEY_FILE</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_set_the_signing_configuration_in_your_gradle_properties_file"><a class="anchor" href="#_set_the_signing_configuration_in_your_gradle_properties_file"></a>Set the signing configuration in your gradle.properties file</h6>
<div class="paragraph">
<p>Add to your gradle.properties :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>signing.gnupg.keyName=ID_OF_THE_GPG_KEY_TO_USE
signing.secretKeyRingFile=LOCATION_OF_THE_KEYRING_HOLDING_THE_GPG_KEY</pre>
</div>
</div>
<div class="paragraph">
<p>To get the keyName (ID_OF_THE_GPG_KEY_TO_USE) use :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpg2 --list-secret-keys</pre>
</div>
</div>
<div class="paragraph">
<p>LOCATION_OF_THE_KEYRING_HOLDING_THE_GPG_KEY is usually /YOUR_HOME_DIRECTORY/.gnupg/pubring.kbx</p>
</div>
</div>
<div class="sect5">
<h6 id="_set_the_credential_for_the_publication"><a class="anchor" href="#_set_the_credential_for_the_publication"></a>Set the credential for the publication</h6>
<div class="paragraph">
<p>For the publication to the staging repository (OSSRH) to work, you need to set the credentials in your gradle.properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ossrhUsername=SONATYPE_JIRA_USERNAME
ossrhPassword=SONATYPE_JIRA_PASSWORD</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The credentials need to belong to an account that has been granted the required privileges on the project (this
is done by Sonatype on request via the same JIRA).
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_more_information"><a class="anchor" href="#_more_information"></a>More information</h6>
<div class="paragraph">
<p>See <a href="https://makandracards.com/makandra-orga/notes/37763-gpg-extract-private-key-and-import-on-different-machine">this link</a>
for more information about importing a GPG key to your machine and getting its id.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_relevant_tasks"><a class="anchor" href="#_relevant_tasks"></a>6.2.2.2. Relevant tasks</h5>
<div class="paragraph">
<p>These plugins and the associated configuration in the <code>client.gradle</code> file make the following tasks available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>publishClientLibraryMavenPublicationToOssrhRepository</code>: this will publish the client jars to the OSSRH repository (in the
case of a X.X.X.RELEASE version) or to a <code>repos</code> directory in the build directory (in the case of a <code>SNAPSHOT</code> version).</p>
</li>
<li>
<p><code>publishClientLibraryMavenPublicationToMavenLocal</code>: this will publish the client jars to the local Maven repository</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The publication tasks will call the signing task automatically.</p>
</div>
<div class="paragraph">
<p>See the plugins documentations for more details on the other tasks available and the dependencies between them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As the client library publication is currently the only configured publication in our build, it is also possible
to use the corresponding aggregate tasks as shortcuts: <code>publish</code> instead of
<code>publishClientLibraryMavenPublicationToOssrhRepository</code> and <code>publishToMavenLocal</code> instead of
<code>publishClientLibraryMavenPublicationToMavenLocal</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gradle_plugins"><a class="anchor" href="#_gradle_plugins"></a>6.2.3. Gradle Plugins</h4>
<div class="paragraph">
<p>In addition to these custom tasks and standard Gradle tasks, OperatorFabric
uses several Gradle plugins, among which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/">Spring Boot Gradle Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/palantir/gradle-docker">Palantir Docker Gradle Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/avast/gradle-docker-compose-plugin/">Docker Compose Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/int128/gradle-swagger-generator-plugin">Gradle Swagger Generator Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/asciidoctor/asciidoctor-gradle-plugin">Gradle Asciidoctor Plugin</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_testing_with_karate_dsl"><a class="anchor" href="#_api_testing_with_karate_dsl"></a>6.3. API testing with Karate DSL</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your OperatorFabric instance is not running on localhost, you need to replace localhost with the address
of your running instance within the <code>karate-config.js</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the scripts and test files are in src/test/api/karate.</p>
</div>
<div class="sect3">
<h4 id="_run_a_feature"><a class="anchor" href="#_run_a_feature"></a>6.3.1. Run a feature</h4>
<div class="paragraph">
<p>To launch a specific test, launch in src/test/api/karate.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$OF_HOME/gradlew karate --args=myfeature.feature</pre>
</div>
</div>
<div class="paragraph">
<p>The result will be available in the <code>target</code> repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_non_regression_tests"><a class="anchor" href="#_non_regression_tests"></a>6.3.2. Non regression tests</h4>
<div class="paragraph">
<p>You can launch operatorFabric non-regression tests via the script launchAll.sh in src/test/api/karate.</p>
</div>
<div class="paragraph">
<p>To have the test passed, you need to have a clean Mongo DB database. To do that, you can use the scripts :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>src/test/resources/deleteAllCards.sh</p>
</li>
<li>
<p>src/test/resources/deleteAllArchivedCards.sh</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cypress_tests"><a class="anchor" href="#_cypress_tests"></a>6.4. Cypress Tests</h3>
<div class="paragraph">
<p>Automatic UI testing</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All paths for cd are given assuming you&#8217;re starting from <code>$OF_HOME</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_installation"><a class="anchor" href="#_installation"></a>6.4.1. Installation</h4>
<div class="paragraph">
<p>Before running Cypress tests for the first time you need to install it using NPM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/cypress
npm install</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cypress_file_structure"><a class="anchor" href="#_cypress_file_structure"></a>6.4.2. Cypress file structure</h4>
<div class="paragraph">
<p>By default, all test files are located in <code>cypress/cypress/integration</code> but it is possible to put it on another directory</p>
</div>
<div class="paragraph">
<p>The <code>commands.js</code> file under <code>cypress/cypress/support</code> is used to create custom commands and overwrite existing commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="_launching_the_opfab_instance_to_test"><a class="anchor" href="#_launching_the_opfab_instance_to_test"></a>6.4.3. Launching the OpFab instance to test</h4>
<div class="sect4">
<h5 id="_commands"><a class="anchor" href="#_commands"></a>6.4.3.1. Commands</h5>
<div class="paragraph">
<p>You can launch the OpFab instance for Cypress tests either in dev or docker mode. The following commands launch the
instance in docker mode, just substitute <code>dev</code> for <code>docker</code> to launch it in dev mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd config/docker
docker-compose down <i class="conum" data-value="1"></i><b>(1)</b>
./docker-compose-cypress.sh <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remove existing config/docker containers to avoid conflicts</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start "Cypress-flavoured" containers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you&#8217;re done with your tests, you can stop and destroy containers (as it is better to start with fresh containers to avoid
side-effects from previous tests) with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd config/docker
docker-compose down</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation"><a class="anchor" href="#_explanation"></a>6.4.3.2. Explanation</h5>
<div class="paragraph">
<p>The Cypress tests rely on a running OpFab instance that is an adaptation from the config/docker docker-compose file
(environment name, shorter time before lttd clock display, etc.).</p>
</div>
<div class="paragraph">
<p>The <code>generateUIConfigForCypress.sh</code> script performs this adaptation to create this base Cypress configuration.</p>
</div>
<div class="paragraph">
<p>This will create the following files under <code>config/cypress/ui-config</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ui-menu.json</p>
</li>
<li>
<p>ui-menu-base.json</p>
</li>
<li>
<p>web-ui.json</p>
</li>
<li>
<p>web-ui-base.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>XXX-base.json</code> and <code>XXX.json</code> are created by copying the corresponding <code>XXX.json</code> file for standard docker
configuration (found under <code>config/docker/ui-config</code>) and making the necessary adaptations needed for the cypress instance to
work well for the tests (changing the authentication mode, making all features visible, etc.).</p>
</div>
<div class="paragraph">
<p>Then, during the course of the cypress tests, the <code>XXX.json</code> files will be modified to test specific features
(for example, hiding a feature, defining a new menu, etc.). They are reset with the content of <code>XXX-base.json</code>
before each test or series of test.</p>
</div>
<div class="paragraph">
<p>The docker container relies on the <code>XXX.json</code> files under <code>config/cypress/ui-config</code>.</p>
</div>
<div class="paragraph">
<p>For convenience, the <code>generateUIConfigForCypress.sh</code> is launched as part of the <code>docker-compose-cypress.sh</code> scripts.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_existing_tests"><a class="anchor" href="#_running_existing_tests"></a>6.4.4. Running existing tests</h4>
<div class="paragraph">
<p>To launch the Cypress test runner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/cypress
./node_modules/.bin/cypress open</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will open the Cypress test runner. Either click on the test you want to run or <code>run all X tests</code> on the right to
run all existing tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can select the browser (and version) that you want to use from a dropdown list on the right. The list will
display the browsers that are currently installed on your computer (and supported by Cypress).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_running_tests_on_4200_ng_serve"><a class="anchor" href="#_running_tests_on_4200_ng_serve"></a>6.4.5. Running tests on 4200 (ng serve)</h4>
<div class="paragraph">
<p>Follow the steps described above in "Dev mode" to start a Cypress-flavoured OpFab instance in development mode, then
run ng serve to start a dynamically generated ui on port 4200:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd ui/main
ng serve</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then launch the Cypress test runner as follows:</p>
</div>
<div class="paragraph">
<p>To launch the Cypress test runner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/cypress
./node_modules/.bin/cypress open --config baseUrl=http://localhost:4200</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_tests_with_gradle"><a class="anchor" href="#_running_tests_with_gradle"></a>6.4.6. Running tests with Gradle</h4>
<div class="paragraph">
<p>The tests can also be run in command line mode using a Gradle task :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew runCypressTests</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run a subset of the tests, for example if you want to run all the tests starting with 'User':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew runSomeCypressTests -PspecFiles=User*</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clearing_mongodb"><a class="anchor" href="#_clearing_mongodb"></a>6.4.7. Clearing MongoDB</h4>
<div class="paragraph">
<p>If you want to start with a clean database (from the cards and archived cards point of view), you can purge the
associated collections through the MongoDB shell with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker exec -it docker_mongodb_1 bash
mongo &quot;mongodb://root:password@localhost:27017/?authSource=admin&amp;authMode=scram-sha1&quot;
use operator-fabric
db.cards.remove({})
db.archivedCards.remove({})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_current_status_of_tests"><a class="anchor" href="#_current_status_of_tests"></a>6.4.8. Current status of tests</h4>
<div class="paragraph">
<p>All tests should be passing when run alone (i.e. not with run all specs) against empty card/archived cards collections.
However, tests in the "Flaky" folder can sometimes fail because they involve dates (round up errors for example).</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_new_tests"><a class="anchor" href="#_creating_new_tests"></a>6.4.9. Creating new tests</h4>
<div class="paragraph">
<p>Create a new XXXX.spec.js file under <code>cypress/cypress/integration</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We will need to define a convention for naming and organizing tests.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_useful_documentation"><a class="anchor" href="#_useful_documentation"></a>6.4.9.1. Useful documentation</h5>
<div class="sect5">
<h6 id="_cypress_documentation"><a class="anchor" href="#_cypress_documentation"></a>Cypress Documentation</h6>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.cypress.io/guides/references/assertions#Common-Assertions">Most Common Assertions</a></p>
</li>
<li>
<p><a href="https://docs.cypress.io/guides/references/assertions">Assertions Reference</a></p>
</li>
<li>
<p><a href="https://docs.cypress.io/faq/questions/using-cypress-faq">FAQ</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_other_links"><a class="anchor" href="#_other_links"></a>Other links</h6>
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/slido-dev-blog/cypress-tips-4-testing-lists-of-items-dccd4b688816">Testing lists of items</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en/docs/Learn/HTML/Howto/Use_data_attributes">Use data attributes</a></p>
</li>
<li>
<p><a href="https://codelikethis.com/lessons/javascript/cypress#anchor/nothing_happens_immediately">Nothing happens immediately</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_guidelines_and_tips"><a class="anchor" href="#_guidelines_and_tips"></a>6.4.9.2. Guidelines and tips</h5>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="https://docs.cypress.io/api/commands/get#Get-in-within">find or within commands</a> rather than complex CSS
selectors to target descendants elements.</p>
</li>
<li>
<p>If you want to access aliases using the <code>this</code> keyword, make sure you are using anonymous functions rather than fat
arrow functions, otherwise use cy.get('@myAlias') to access it asynchronously
(<a href="https://docs.cypress.io/guides/core-concepts/variables-and-aliases#Avoiding-the-use-of-this">the documentation</a>
has recently been updated on this topic).</p>
</li>
<li>
<p>When running tests, make sure that you are not connected to OpFab as it can cause unexpected behaviour with read
cards for example.</p>
</li>
<li>
<p>When chaining a <code>should</code> assertion to a <code>cy.get</code> command that returns several elements, it will pass if it is true for
ANY of these elements. Use each + callback to check that an assertion is true on every element.</p>
</li>
<li>
<p><code>cy.contains</code> is a command, not an assertion. If you want to test the attribute, classes, content etc. of an element,
it&#8217;s better to target the element by id or data attribute using a <code>cy.get()</code> command for example and then chain an
assertion with <code>should()</code>.
This way, you will get an expected/actual error message if the assertion fails, you will avoid false positives (text is
found in another sibling element) and hard to debug behaviour with retries.</p>
</li>
<li>
<p>Be careful with <code>find()</code> (see #1751 for an example of issue that it can cause). See the Cypress documentation for
<a href="https://docs.cypress.io/guides/core-concepts/retry-ability#Only-the-last-command-is-retried">an
explanation</a> and <a href="https://docs.cypress.io/guides/core-concepts/retry-ability#Merging-queries">a less flaky alternative</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a>6.4.10. Configuration</h4>
<div class="paragraph">
<p>In <code>cypress.json</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>baseUrl</code>: The base url of the OperatorFabric instance you&#8217;re testing against. It will be appended in front of any
<code>visit</code> call.</p>
</li>
<li>
<p><code>env.host</code>: The host corresponding to the OperatorFabric instance you&#8217;re testing against. It will be used for API
calls.</p>
</li>
<li>
<p><code>env.defaultWaitTime</code>: Using the custom-defined command cy.waitDefaultTime() instead of cy.wait(XXX) allows the wait
time to be changed globally for all steps to the value defined by this property.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_useful_recipes"><a class="anchor" href="#_useful_recipes"></a>7. Useful recipes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_sub_project_from_jar_file"><a class="anchor" href="#_running_sub_project_from_jar_file"></a>7.1. Running sub-project from jar file</h3>
<div class="ulist">
<ul>
<li>
<p>java -jar [sub-projectPath]/build/libs/[sub-project].jar</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_properties_when_running_from_jar_file"><a class="anchor" href="#_overriding_properties_when_running_from_jar_file"></a>7.2. Overriding properties when running from jar file</h3>
<div class="ulist">
<ul>
<li>
<p>java -jar [sub-projectPath]/build/libs/[sub-project].jar
–spring.config.additional-location=file:[filepath]
NB : properties may be set using ".properties" file or ".yml" file. See
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">Spring
Boot configuration</a> for more info.</p>
</li>
<li>
<p>Generic property list extract :</p>
<div class="ulist">
<ul>
<li>
<p>server.port (defaults to 8080) : embedded server port</p>
</li>
</ul>
</div>
</li>
<li>
<p>:services:core:businessconfig-party-service properties list extract :</p>
<div class="ulist">
<ul>
<li>
<p>operatorfabric.businessconfig.storage.path (defaults to &quot;&quot;) : where to
save/load OperatorFabric Businessconfig  data</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_generating_docker_images"><a class="anchor" href="#_generating_docker_images"></a>7.3. Generating docker images</h3>
<div class="paragraph">
<p>To Generate all docker images run `./gradlew dockerTagSnaphot'</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_documentation_from_asciidoc_sources"><a class="anchor" href="#_generating_documentation_from_asciidoc_sources"></a>7.4. Generating documentation (from AsciiDoc sources)</h3>
<div class="paragraph">
<p>The sources for the documentation are located under <code>src/docs/asciidoc</code>. To generate HTML pages from these sources,
use the <code>asciidoctor</code> gradle task from the project root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd $OF_HOME
./gradlew asciidoctor</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task output can be found under <code>$OF_HOME/build/docs/asciidoc</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_api_documentation"><a class="anchor" href="#_generating_api_documentation"></a>7.5. Generating API documentation</h3>
<div class="paragraph">
<p>The documentation for the API is generated from the <code>swagger.yaml</code> definitions using SwaggerUI. To generate the
API documentation, use the <code>generateSwaggerUI</code> gradle task, either from the project root or from one of the services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd $OF_HOME
./gradlew generateSwaggerUI</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task output can be found for each service under <code>[service-path]/build/docs/api</code>
(for example <code>services/businessconfig/build/docs/api</code>). Open the <code>index.html</code> file in a browser to have a look at
the generated SwaggerUI.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>8. Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p> <details><summary> 
<strong>Proxy error when running businessconfig-party docker-compose</strong>
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Pulling rabbitmq (rabbitmq:3-management)...
ERROR: Get https://registry-1.docker.io/v2/: Proxy Authentication Required</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>When running docker-compose files using businessconfig-party images(such as rabbitmq,
mongodb etc.) the first time, docker will need to pull these images from
their repositories.
If the docker proxy isn&#8217;t set properly, you will see the above message.</p>
</div>
<div class="paragraph">
<p>To set the proxy, follow <a href="https://docs.docker.com/config/daemon/systemd/">these
steps from the docker documentation</a>.</p>
</div>
<div class="paragraph">
<p>If your proxy needs authentication, add your user and password as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP_PROXY=http://user:password@proxy.example.com:80/</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The password should be URL-encoded.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Gradle Metaspace error</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>Gradle task (for example gradle build) fails with the following error:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>* What went wrong:
Metaspace</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>Issue with the Gradle daemon. Stopping the daemon using <code>./gradlew --stop</code>
and re-launching the build should solve this issue.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Java version not available when setting up environment</strong>
 </summary><div> 
When sourcing the <a href="https://github.com/opfab/operatorfabric-core/blob/master/bin/load_environment_light.sh">load_environment_light</a>
script to set up your environment, you might get the following error message:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Stop! java 8.0.192-zulu is not available. Possible causes:
 * 8.0.192-zulu is an invalid version
 * java binaries are incompatible with Linux64
 * java has not been released yet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select the next available version and update
<a href="https://github.com/opfab/operatorfabric-core/blob/master/bin/load_environment_light.sh">load_environment_light</a> accordingly before
sourcing it again.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The java version currently listed in the script might have been deprecated
(for security reasons) or might not be available for your operating system
(for example, 8.0.192-zulu wasn&#8217;t available for Ubuntu).</p>
</div>
<div class="paragraph">
<p>Run <code>sdk list java</code> to find out which versions are available. You will get
this kind of output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>================================================================================
Available Java Versions
================================================================================
     13.ea.16-open       9.0.4-open          1.0.0-rc-11-grl
     12.0.0-zulu         8.0.202-zulu        1.0.0-rc-10-grl
     12.0.0-open         8.0.202-amzn        1.0.0-rc-9-grl
     12.0.0-librca       8.0.202.j9-adpt     1.0.0-rc-8-grl
     11.0.2-zulu         8.0.202.hs-adpt
     11.0.2-open         8.0.202-zulufx
     11.0.2-amzn         8.0.202-librca
     11.0.2.j9-adpt      8.0.201-oracle
     11.0.2.hs-adpt  &gt; + 8.0.192-zulu
     11.0.2-zulufx       7.0.211-zulu
     11.0.2-librca       6.0.119-zulu
     11.0.2-sapmchn      1.0.0-rc-15-grl
     10.0.2-zulu         1.0.0-rc-14-grl
     10.0.2-open         1.0.0-rc-13-grl
     9.0.7-zulu          1.0.0-rc-12-grl

================================================================================
+ - local version
* - installed
&gt; - currently in use
================================================================================</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>BUILD FAILED with message <code>Execution failed for task ':ui:main-user-interface:npmInstall'.</code></strong>
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>FAILURE: Build failed with an exception.

    What went wrong:
    Execution failed for task ':ui:main-user-interface:npmInstall'.</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>A <code>sudo</code> has been used before the <code>./gradlew assemble</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t use <strong>sudo</strong> to build OperatorFabric otherwise unexpected problems could arise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl get Failed to connect to localhost:2002: Connection refused</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>curl: (7) Failed to connect to localhost port 2002: Connexion refused</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The <code>web-ui</code> docker container stops running. Check its configuration.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl 404 status return by ngnix</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/thirds/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.17.10&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The requested page is not or no more mapped by the <code>nginx.conf</code> of <code>web-ui</code>.
Update it or check for the new end point of the desired page.</p>
</div>
<div class="paragraph">
<p>For this example, <code>businessconfig</code> replaces now the former <code>thirds</code> end-point.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl 404 status return by OperatorFabric</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/businessconfig/ -H &quot;Authorization: Bearer ${token}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid OAuth2 JWT.</p>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>{&quot;timestamp&quot;:&quot;XXXX-XX-XXTXX:XX:XX.XXX+00:00&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:&quot;&quot;,&quot;path&quot;:&quot;/businessconfig&quot;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>XXXX-XX-XXTXX:XX:XX.XXX+00:00</code> is a time stamp corresponding to the moment when the request has been sent.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The requested end-point is not or no more valid in <code>OperatorFabric</code>.
Check the API documentation for correct path.</p>
</div>
<div class="paragraph">
<p>For this example, <code>businessconfig/processes</code> is a correct end-point whereas <code>businessconfig</code> alone is not.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>ERROR: for web-ui</code> when running docker-compose in <code>${OF_HOME}/config/dev</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>ERROR: for web-ui  Cannot start service web-ui: OCI runtime create failed: container_linux.go:345: starting container process caused &quot;process_linux.go:430: container init caused \&quot;rootfs_linux.go:58: mounting \\\&quot;/home/legallron/projects/operatorfabric-core/config/dev/nginx.conf\\\&quot; to rootfs …</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>…</code> is specific to the runtime environment.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>There is no <code>nginx.conf</code> file in the <code>${OF_HOME}/conf/dev</code> directory.</p>
</div>
<div class="paragraph">
<p>A first run of OperatorFabric <code>docker-compose</code> in dev config needs a <code>nginx.conf</code> file.
To create it, and run a docker-compose environment use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>If docker-compose has created a <code>nginx.conf</code> directory, delete it before running the previous commands.</p>
</div>
<div class="paragraph">
<p>Once this <code>nginx.conf</code> file created a simple <code>docker-compose up -d</code> is enough to run a dev docker-compose environment.
Sometimes a <code>nginx.conf</code> has been created as an attempt to launch the <code>web-ui</code> docker.
See the following section to resolve this.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>/docker-compose.sh: ligne 7: ./nginx.conf: is a folder</code> when running <code>${OF_HOME}/config/dev/docker-compose.sh</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>./docker-compose.sh: ligne 7: ./nginx.conf: is a folder</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes</div>
<p>A <code>docker-compose up</code> has been run previously without <code>nginx.conf</code>.
A folder named <code>nginx.conf</code> has been created by <code>docker-compose</code>.</p>
</div>
<div class="paragraph">
<div class="title">Resolution</div>
<p>You have rights to delete the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
rm -rf nginx.conf
./docker-compose.sh # if you want to run OperatorFabric directly after.
cd ${OF_HOME}
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t have the rights to delete the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
docker run -ti --rm -v $(pwd):/current alpine # if there is no `alpine` docker available it will pull it from dockerHub
# your are now in the alpine docker container
cd /current
rm -rf nginxconf
&lt;ctrl-d&gt; # to exit the `alpine` container bash environement
./docker-compose.sh # if you want to run OperatorFabric directly after.
cd ${OF_HOME}
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>An unhandled exception occurred: Call retries were exceeded</code> occurs when using <code>ng build</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/ui/main
ng build</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Generating ES5 bundles for differential loading...
An unhandled exception occurred: Call retries were exceeded
See &quot;/tmp/ng-&lt;random-string&gt;/angular-errors.log&quot; for further details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ng-&lt;random-string&gt;</code> is a temporary folder created by Angular to build the front-end.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>There is not enough allocated memory space to build the front-end.</p>
</div>
<div class="paragraph">
<p>Use the following command to solve the problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">node --max_old_space_size=4096 node_modules/@angular/cli/bin/ng build</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak_configuration"><a class="anchor" href="#_keycloak_configuration"></a>9. Keycloak Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration needed for development purposes is automatically loaded from the dev-realms.json file.
However, the steps below describe how they can be reproduced from scratch on a blank Keycloak instance in case you
want to add to it.</p>
</div>
<div class="paragraph">
<p>The Keycloak Management interface is available here:  [host]:89/auth/admin
Default credentials are admin/admin.</p>
</div>
<div class="sect2">
<h3 id="_add_realm"><a class="anchor" href="#_add_realm"></a>9.1. Add Realm</h3>
<div class="ulist">
<ul>
<li>
<p>Click top left down arrow next to Master</p>
</li>
<li>
<p>Add Realm</p>
</li>
<li>
<p>Name it dev (or whatever)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setup_at_least_one_client_or_best_one_per_service"><a class="anchor" href="#_setup_at_least_one_client_or_best_one_per_service"></a>9.2. Setup at least one client (or best one per service)</h3>
<div class="sect3">
<h4 id="_create_client"><a class="anchor" href="#_create_client"></a>9.2.1. Create client</h4>
<div class="ulist">
<ul>
<li>
<p>Click Clients in left menu</p>
</li>
<li>
<p>Click Create Button</p>
</li>
<li>
<p>Set client ID to "opfab-client" (or whatever)</p>
</li>
<li>
<p>Select Openid-Connect Protocol</p>
</li>
<li>
<p>Enable Authorization</p>
</li>
<li>
<p>Access Type to Confidential</p>
</li>
<li>
<p>save</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_role_to_client"><a class="anchor" href="#_add_a_role_to_client"></a>9.2.2. Add a Role to Client</h4>
<div class="ulist">
<ul>
<li>
<p>In client view, click Roles tab</p>
</li>
<li>
<p>Click Add button</p>
</li>
<li>
<p>create a USER role (or whatever)</p>
</li>
<li>
<p>save
== create a Mapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Used to map the user name to a field that suits services</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name it sub</p>
</li>
<li>
<p>set mapper type to User Property</p>
</li>
<li>
<p>set Property to username</p>
</li>
<li>
<p>set Token claim name to sub</p>
</li>
<li>
<p>enable add to access token</p>
</li>
<li>
<p>save</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_users"><a class="anchor" href="#_create_users"></a>9.3. Create Users</h3>
<div class="ulist">
<ul>
<li>
<p>Click Users in left menu</p>
</li>
<li>
<p>Click Add User button</p>
</li>
<li>
<p>Set username to admin</p>
</li>
<li>
<p>Save</p>
</li>
<li>
<p>Select Role Mappings tab</p>
</li>
<li>
<p>Select "opfab-client" in client roles combo (or whatever id you formerly chose)</p>
</li>
<li>
<p>Select USER  as assigned role (or whatever role you formerly created)</p>
</li>
<li>
<p>Select Credentials tab</p>
</li>
<li>
<p>set password and confirmation to "test"
*</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>repeat process for other users:
operator3_fr, operator1_fr, operator2_fr</p>
</div>
<div class="sect3">
<h4 id="_development_specific_configuration"><a class="anchor" href="#_development_specific_configuration"></a>9.3.1. Development-specific configuration</h4>
<div class="paragraph">
<p>To facilitate development, in  the configuration file provided in the git (dev-realms.json) ,session are set to have
a duration of 10 hours (36000 seconds) and SSL is not required. These parameters should not be used in production.</p>
</div>
<div class="paragraph">
<p>The following parameters are set :
accessTokenLifespan : 36000
ssoSessionMaxLifespan : 36000
accessCodeLifespan" : 36000
accessCodeLifespanUserAction : 36000
sslRequired : none</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_oauth2_token_with_the_cli"><a class="anchor" href="#_using_oauth2_token_with_the_cli"></a>10. Using OAuth2 token with the CLI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_a_token"><a class="anchor" href="#_get_a_token"></a>10.1. Get a token</h3>
<div class="paragraph">
<p>End point: <code><a href="http://localhost:2002/auth/token" class="bare">localhost:2002/auth/token</a></code></p>
</div>
<div class="paragraph">
<p>Method: <code>POST</code></p>
</div>
<div class="paragraph">
<p>Body arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>client_id: <code>string</code> constant=<code>clientIdPassword</code>;</p>
</li>
<li>
<p>grant_type: <code>string</code> constant=<code>password</code>;</p>
<div class="ulist">
<ul>
<li>
<p>username: <code>string</code> any value, must match an OperatorFabric registered user name;</p>
</li>
</ul>
</div>
</li>
<li>
<p>password: <code>string</code> any value;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples will be for <code>admin</code> user.</p>
</div>
<div class="sect3">
<h4 id="_curl"><a class="anchor" href="#_curl"></a>10.1.1. Curl</h4>
<div class="paragraph">
<p>command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d
"username=admin&amp;password=test&amp;grant_type=password&amp;client_id=clientIdPassword"
http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cC
I6MTU1MjY1OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOi
IwMmQ4MmU4NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZF
Bhc3N3b3JkIiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0
rWVtFGAZzRHj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdK
VAz0CkMKqng4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVD
SJew1rj5EiSybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZC
AYVM-mmHbjk8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw","to
ken_type":"bearer","refresh_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWI
iOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLCJ1c2VyX2luZm8iXSwiYXRpIjoiMDJkODJlODUtMTNmMC0
0Njc4LTk3NGQtMThlYjA2MjE1YTY1IiwiZXhwIjoxNTUyNzAxMTM4LCJhdXRob3JpdGllcyI6WyJST0x
FX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aSI6IjMwOWY2ZDllLWNmOGEtNDg0YS05ZjMxLWViOTAxYzk
4YTFkYSIsImNsaWVudF9pZCI6ImNsaWVudElkUGFzc3dvcmQifQ.jnZDt6TX2BvlmdT5JV-A7eHTJz_s
lC5fHrJFVI58ly6N7AUUfxebG_52pmuVHYULSKqTJXaLR866r-EnD4BJlzhk476FtgtVx1nazTpLFRLb
8qDCxeLrzClQBkzcxOt6VPxB3CD9QImx3bcsDwjkPxofUDmdg8AxZfGTu0PNbvO8TKLXEkeCztLFvSJM
GlN9zDzWhKxr49I-zPZg0XecgE9j4WITkFoDVwI-AfDJ3sGXDi5AN55Sz1j633QoqVjhtc0lO50WPVk5
YT7gU8HLj27EfX-6vjnGfNb8oeq189-NX100QHZM9Wgm79mIm4sRgwhpv-zzdDAkeb3uwIpb8g","exp
ires_in":1799,"scope":"read
user_info","jti":"02d82e85-13f0-4678-974d-18eb06215a65"}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie"><a class="anchor" href="#_httpie"></a>10.1.2. Httpie</h4>
<div class="listingblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/token username=admin password=test
grant_type=password client_id=clientIdPassword</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.HTTP/1.1 200 OK
Cache-Control: no-store
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 13:57:19 GMT
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "access_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOS
wiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yz
g3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2
NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd
3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST
8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge
8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfD
J6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q",
    "expires_in": 1799,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "refresh_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLC
J1c2VyX2luZm8iXSwiYXRpIjoiNjI0MzA5YjEtN2M4Ny00Y2RjLTg0NDMtMDEyNDUxNWY4N2Y4IiwiZX
hwIjoxNTUyNzAxNDM5LCJhdXRob3JpdGllcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aS
I6ImRiYzMxNTJiLTM4YTUtNGFmZC1hY2VmLWVkZTI4MjJkOTE3YyIsImNsaWVudF9pZCI6ImNsaWVudE
lkUGFzc3dvcmQifQ.Ezd8kbfNQHOOvUCNNN4UmOOkncHiT9QVEM63FiW1rq0uXDa3xfBGil8geM5MsP0
7Q2He-mynkFb8sGNDrAXTdO-8r5o4a60zWrktrMg2QH4icC1lyeZpiwZxe6675QpLpSeMlXt9PdYj-pb
14lrRookxXP5xMQuIMteZpbtby7LuuNAbNrjveZ1bZ4WMi7zltUzcYUuqHlP1AYPteGRrJVKXiuPpoDv
gwMsEk2SkgyyACI7SdZZs8IT9IGgSsIjjgTMQKzj8P6yYxNLUynEW4o5y1s2aAOV0xKrzkln9PchH9zN
qO-fkjTVRjy_LBXGq9zkn0ZeQ3BUe1GuthvGjaA",
    "scope": "read user_info",
    "token_type": "bearer"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_token"><a class="anchor" href="#_extract_token"></a>10.2. Extract token</h3>
<div class="paragraph">
<p>From the previous results, the data need to be considered to be authenticated by OperatorFabric services is the content of the <code>"access_token"</code> attribute of the body response.</p>
</div>
<div class="paragraph">
<p>Once this value extracted, it need to be passed at the end of the value of the http HEADER of type <code>Authorization:Bearer</code>. Note that a space is needed between <code>Bearer</code> and token actual value.
example from previous results:</p>
</div>
<div class="sect3">
<h4 id="_curl_2"><a class="anchor" href="#_curl_2"></a>10.2.1. Curl</h4>
<div class="listingblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1OTczOCw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4NS0xM2Y
wLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzRHj7KPga
OXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqng4kQeQm
_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5EiSybuy83
PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbjk8mF89f
L9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_2"><a class="anchor" href="#_httpie_2"></a>10.2.2. Httpie</h4>
<div class="listingblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOSw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yzg
3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd3
PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST8
fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge8
scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfDJ
6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_a_token"><a class="anchor" href="#_check_a_token"></a>10.3. Check a token</h3>
<div class="sect3">
<h4 id="_curl_3"><a class="anchor" href="#_curl_3"></a>10.3.1. Curl</h4>
<div class="paragraph">
<p>from previous example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d
"token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1
OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4
NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3Jk
Iiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzR
Hj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqn
g4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5Ei
Sybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbj
k8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw"
http://localhost:2002/auth/check_token</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "sub":"admin",
    "scope":["read","user_info"],
    "active":true,"exp":1552659738,
    "authorities":["ROLE_ADMIN","ROLE_USER"],
    "jti":"02d82e85-13f0-4678-974d-18eb06215a65",
    "client_id":"clientIdPassword"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_3"><a class="anchor" href="#_httpie_3"></a>10.3.2. Httpie</h4>
<div class="paragraph">
<p>from previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/check_token
token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2M
DAzOSwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliM
S03Yzg3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkI
iwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2q
Fa5Bd3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lH
Dd8ST8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNX
J4Bge8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeA
pKdfDJ6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 14:19:31 GMT
Expires: 0
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "active": true,
    "authorities": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "client_id": "clientIdPassword",
    "exp": 1552660039,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "scope": [
        "read",
        "user_info"
    ],
    "sub": "admin"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_token_2"><a class="anchor" href="#_extract_token_2"></a>10.4. Extract token</h3>
<div class="paragraph">
<p>The utility <code>jq</code>, sadly not always available on some Linux distro, parses json input and extracts requested json path value(<code>access_token</code> here).
Here is a way to do so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell"> curl -d &quot;username=${user}&amp;password=${password}&amp;grant_type=password&amp;client_id=opfab-client&quot; &quot;http://localhost:2002/auth/token&quot; | jq -r .access_token</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${user}</code>: login existing on keycloak for operatorfabric;</p>
</li>
<li>
<p><code>${password}</code>: password for the previous login in keycloak;</p>
</li>
<li>
<p><code>opfab-client</code>:  is the id of the client for OperatorFabric associated to the <code>dev</code> realm in Keycloak in a <code>dev</code>(<code>${OF_HOME/config/dev</code>) or <code>docker</code>(<code>${OF_HOME/config/docker</code>) configuration of operatorFabric.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>-r</code> option, for raw, leaves the output without any quotes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka_implementation"><a class="anchor" href="#_kafka_implementation"></a>11. Kafka Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic.
In the default configuration Kafka is disabled.</p>
</div>
<div class="sect2">
<h3 id="_setup_kafka_enviroment"><a class="anchor" href="#_setup_kafka_enviroment"></a>11.1. Setup Kafka enviroment</h3>
<div class="paragraph">
<p>If you do not have a Kafka environment running you need to set one up so the Kafka consumers and producers can find each other.
You can for example download <a href="{lense}">lenses.io</a> for an easy-to-use broker with a graphical interface. Another option is to add
a free broker like a bitnami Kafka image to docker compose. To do so, add the following lines to <code>config/dev/docker-compose.yml</code> or
<code>config/docker/docker-compose.yml</code> for the zookeeper and bitnami images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">services</span>:
  <span class="key">zookeeper</span>:
    <span class="key">image</span>: <span class="string"><span class="content">bitnami/zookeeper:3</span></span>
    <span class="key">ports</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">2181:2181</span><span class="delimiter">&quot;</span></span>
    <span class="key">environment</span>:
      <span class="key">ALLOW_ANONYMOUS_LOGIN</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>
  <span class="key">kafka</span>:
    <span class="key">image</span>: <span class="string"><span class="content">bitnami/kafka:2</span></span>
    <span class="key">ports</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">9092:9092</span><span class="delimiter">&quot;</span></span>
    <span class="key">environment</span>:
      <span class="key">KAFKA_BROKER_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
      <span class="key">KAFKA_LISTENERS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PLAINTEXT://:9092</span><span class="delimiter">&quot;</span></span>
      <span class="key">KAFKA_ADVERTISED_LISTENERS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PLAINTEXT://172.17.0.1:9092</span><span class="delimiter">&quot;</span></span>
      <span class="key">KAFKA_ZOOKEEPER_CONNECT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeper:2181</span><span class="delimiter">&quot;</span></span>
      <span class="key">ALLOW_PLAINTEXT_LISTENER</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>
  <span class="key">rabbitmq</span>:</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_kafka"><a class="anchor" href="#_enabling_kafka"></a>11.2. Enabling Kafka</h3>
<div class="paragraph">
<p>To enable Kafka support you need to set the <code>kafka.consumer.group_id property</code> in the <code>cards-publication.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">spring</span>:
    <span class="key">kafka</span>:
      <span class="key">consumer</span>:
        <span class="key">group-id</span>: <span class="string"><span class="content">opfab-command</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default topic from which the messages are consumed is called <code>opfab</code>. This setting can be modified by setting <code>opfab.kafka.card.topics.topicname</code>. Messages are encoded in the <code>CardCommand.card</code> field.
The default topic to which messages are produced is called <code>opfab-response</code>. This setting can be modified by setting the <code>opfab.kafka.topics.response-card</code>, see below. Messages produced by Operator Fabric are encoded in the <code>CardCommand.responseCard</code> field</p>
</div>
<div class="paragraph">
<p>The default Kafka Avro serializers and deserializers need a registry service. Make sure the registry service setting is provided in
the <code>card-publication.yml</code> file. When you use the provided <code>KafkaAvroWithoutRegistrySerializer</code> and
<code>KafkaAvroWithoutRegistryDeserializer</code> no schema registry setting is needed.</p>
</div>
<div class="paragraph">
<p>With the default settings, the Kafka consumer expects a broker running on http//127.0.0.1:9092 and a schema registry on <a href="http://127.0.0.1:8081" class="bare">127.0.0.1:8081</a>.</p>
</div>
<div class="paragraph">
<p>Example settings for the cards-publication.yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">opfab</span>:
  <span class="key">kafka</span>:
    <span class="key">topics</span>:
      <span class="key">card</span>:
        <span class="key">topicname</span>: <span class="string"><span class="content">opfab</span></span>
      <span class="key">response-card</span>:
        <span class="key">topicname</span>: <span class="string"><span class="content">opfab-response</span></span>
    <span class="key">schema</span>:
      <span class="key">registry</span>:
        <span class="key">url</span>: <span class="string"><span class="content">http://localhost:8081</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="/documentation/current/deployment/index.html#cards-pub-conf">Cards-publication service</a>
for more settings.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.confluent.io/current/schema-registry/index.html">Schema management</a> for detailed information on using and benefits of a schema registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_kafka_source_code"><a class="anchor" href="#_operatorfabric_kafka_source_code"></a>11.3. OperatorFabric Kafka source code</h3>

</div>
<div class="sect2">
<h3 id="_listener_deserializer"><a class="anchor" href="#_listener_deserializer"></a>11.4. Listener / deserializer</h3>
<div class="paragraph">
<p>Most of the OperatorFabric Kafka implementation can be found at</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.opfab.cards.publication.kafka</code></dt>
<dd>
<p>for
the implementation of the deserializers and mapping of Kafka topics to OperatorFabric cards and</p>
</dd>
<dt class="hdlist1"><code>org.opfab.autoconfigure.kafka</code> </dt>
<dd>
<p>for the various Kafka configuration options.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_kafka_operatorfabric_avro_schema"><a class="anchor" href="#_kafka_operatorfabric_avro_schema"></a>11.4.1. Kafka OperatorFabric AVRO schema</h4>
<div class="paragraph">
<p>The AVRO schema, the byte format in which messages are transferred using Kafka topics, can be found at <code>client/src/main/avro</code>.
Message are wrapped in a CardCommand object before being sent to a Kafka topic. The CardCommand consists of some additional information and the
OperatorFabric card itself, see also <a href="#card_structure">[card_structure]</a>. The additional information, for example CommandType, consists mostly of the information
present in a REST operation but not in Kafka. For example the http method (POST, DELETE, UPDATE) used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_kafka"><a class="anchor" href="#_configure_kafka"></a>11.5. Configure Kafka</h3>
<div class="sect3">
<h4 id="_setting_a_new_deserializer"><a class="anchor" href="#_setting_a_new_deserializer"></a>11.5.1. Setting a new deserializer</h4>
<div class="paragraph">
<p>By default, OperatorFabric uses the  <code>io.confluent.kafka.serializers.KafkaAvroDeserializer</code> from <a href="https://www.confluent.io/">Confluent</a>. However, you can write your own
deserializer. To use your own deserializer, make sure
<code>spring.deserializer.value.delegate.class</code> points to your deserializer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_a_broker"><a class="anchor" href="#_configuring_a_broker"></a>11.5.2. Configuring a broker</h4>
<div class="paragraph">
<p>When you have a broker running on localhost port 9092, you do not need to set the bootstrap severs. If this is not the case, you need tell
Operator Fabric where the broker can be found. You can do so by setting the bootstrap-servers property in the <code>cards-publication.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">kafka</span>:
    <span class="key">bootstrap-servers</span>: <span class="string"><span class="content">172.17.0.1:9092</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_card_producer"><a class="anchor" href="#_kafka_card_producer"></a>11.6. Kafka card producer</h3>
<div class="paragraph">
<p>To send a CardCommand to OperatorFabric, start by implementing a simple Kafka producer by following for example <a href="https://docs.spring.io/spring-kafka/reference/html/">Spring for Apache Kafka</a>.
Note that some properties of CardCommand or its embedded Card are required. If not set, the card will be rejected by OperatorFabric.</p>
</div>
<div class="paragraph">
<p>When you dump the card (which is about to be put on a topic) to stdout, you should see something like the line below. Do ignore the actual values from the dump below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">command</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE_CARD</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">integrationTest</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fa6ce61f-192f-11eb-a6e3-eea952defe56</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">card</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">parentCardUid</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myFirstPublisher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publishDate</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lttd</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>: <span class="integer">1603897942000</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>: <span class="integer">1604070742000</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">timeSpans</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask.title</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask.summary</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">userRecipients</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">tso1-operator</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">tso2-operator</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesAllowedToRespond</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">hasBeenAcknowledged</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">action</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">Just do something</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_response_cards"><a class="anchor" href="#_response_cards"></a>11.7. Response Cards</h3>
<div class="paragraph">
<p>OperatorFabric
<a href="/documentation/current/reference_doc/index.html#response_cards">response cards</a>
can be sent by REST of put on a Kafka topic. The Kafka response card configuration follows the
convention to configure a REST endpoint. Instead of setting the 'http://host/api' URL, you set it to 'kafka:response-topic' in the <code>external-recipients:</code>
section from the cards-publication.yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">external-recipients</span>:
  <span class="key">recipents</span>:
    - <span class="string"><span class="content">id: &quot;processAction&quot;</span></span>
      <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
      <span class="key">propagateUserToken</span>: <span class="string"><span class="content">false</span></span>
    - <span class="string"><span class="content">id: &quot;mykafka&quot;</span></span>
      <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kafka:topicname</span><span class="delimiter">&quot;</span></span>
      <span class="key">propagateUserToken</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>topicname</code> is a placeholder for now. All response cards are returned via the same Kafka response topic, as specified in the <code>opfab.kafka.topics.response-card</code> field.</p>
</div>
</div>
</div>
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>